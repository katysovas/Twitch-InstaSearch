function toggleVisibility(e,t){e.style.visibility=t?"initial":"hidden"}function hasLocalStorage(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function cleanModal(){document.getElementById("modal-img").src="",document.getElementById("modal-user-img").src=""}function createDOM(e,t,a,n){var r=document.createElement(e);if(null!==t&&t.length>0&&r.appendChild(document.createTextNode(t)),a){var i=document.createAttribute(a);i.value=n,r.setAttributeNode(i)}return r}function update(e){var t=e/100,a=t*width;progress_elt.style.left=Math.floor(a)+"px"}function make_loop(e,t){var a=0,n=t/e,r=function(){e>=a?(update(a++),window.setTimeout(r,n)):progress_elt.style.left="0px"};r()}document.addEventListener("DOMContentLoaded",function(){function e(e){if(e&&l.page<l.maxPages){var a=l.next;l.page++}else{if(e||!(l.page>1))return;a=l.prev,l.page--}t(a)}function t(e){if(hasLocalStorage()&&localStorage.getItem(e))n(JSON.parse(localStorage.getItem(e)));else{if(window.XMLHttpRequest)var t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}if(!t)return!1;t.onreadystatechange=function(){if(t.readyState==XMLHttpRequest.DONE)if(200===t.status){var e=t.responseText;n(JSON.parse(e)),hasLocalStorage&&JSON.parse(e)._total>0&&(make_loop(100,1e3),localStorage.length>l.localStorageMaxItems&&localStorage.clear(),localStorage.setItem(l.url,e))}else console.log(e)},t.open("GET",e),t.setRequestHeader("Accept","application/vnd.twitchtv.v3+json"),t.send()}}function a(e){if(e.game&&(document.getElementById("modal-title").innerHTML=e.game),e.preview.large&&(document.getElementById("modal-img").src=e.preview.large),e.channel.logo&&(document.getElementById("modal-user-img").src=e.channel.logo),e.channel.display_name&&e.channel.url){var t=document.getElementById("modal-username");t.innerHTML=e.channel.display_name,t.href=e.channel.url}}function n(e){l.streamItem=e.streams;var t=document.getElementById("results-list");t.innerHTML="",l.streamItem.forEach(function(e){t.appendChild(r(e))});for(var n=document.querySelectorAll(".openMe"),i=0;i<n.length;i++)n[i].addEventListener("click",function(e){cleanModal();var t=e.currentTarget.parentNode,n=t.getAttribute("data-id");for(var r in l.streamItem)if(l.streamItem.hasOwnProperty(r)){var i=l.streamItem[r];if(i._id==n)return void a(i)}e.preventDefault()});if(l.totalResults=e._total,c.innerHTML=l.totalResults,l.totalResults){toggleVisibility(s,1);var o=s.children[1];l.next=e._links.next,l.prev=e._links.prev,l.maxPages=Math.ceil(e._total/l.limit),o.firstChild.innerHTML=l.page,o.lastChild.innerHTML=l.maxPages;var m=1===l.page?0:1,g=l.page===l.maxPages?0:1;toggleVisibility(u,m),toggleVisibility(d,g)}else toggleVisibility(s,0),toggleVisibility(u,0),toggleVisibility(d,0)}function r(e){var t=createDOM("div","","class","stream"),a=e.preview.template.replace(/{width}/,160).replace(/{height}/,90),n=createDOM("a","","href","#openModal"),r=createDOM("div","","class","stream-info"),i=createDOM("h2",""),l=createDOM("div","","class","stream-description"),o=createDOM("p","");return o.appendChild(createDOM("a",e.game,"href","http://www.twitch.tv/directory/game/"+e.game)),o.appendChild(document.createTextNode(" - "+e.viewers+" viewers")),l.appendChild(o),l.appendChild(createDOM("p",e.channel.status)),i.appendChild(createDOM("a",e.channel.display_name,"href",e.channel.url)),n.className=n.className+"openMe",r.appendChild(i),r.appendChild(l),n.appendChild(createDOM("img","","src",a)),t.setAttribute("data-id",e._id),t.appendChild(n),t.appendChild(r),t}var i,l={totalResults:0,maxPages:1,limit:10,page:1,prev:"",next:"",url:"",query:"",streamItem:null,localStorageMaxItems:30},o=document.getElementById("search-input"),c=document.getElementById("total-results"),s=document.getElementById("navigation"),d=document.getElementById("nextPage"),u=document.getElementById("prevPage"),m=document.querySelectorAll(".filter");document.getElementById("modal-close");o.addEventListener("keyup",function(e){e.preventDefault(),l.query=e.currentTarget.value,l.url="https://api.twitch.tv/kraken/search/streams?limit="+l.limit+"&q="+l.query,i&&clearTimeout(i),l.query.length>3&&(i=setTimeout(function(){t(l.url)},500))}),o.addEventListener("search",function(e){""==e.currentTarget.value&&(c.innerHTML=0,document.getElementById("results-list").innerHTML="",toggleVisibility(s,0),toggleVisibility(u,0),toggleVisibility(d,0))});for(var g=0;g<m.length;g++)m[g].addEventListener("click",function(e){[].forEach.call(m,function(e){e.className=""}),l.limit=e.currentTarget.text,e.currentTarget.className=e.currentTarget.className+" active",l.url="https://api.twitch.tv/kraken/search/streams?limit="+l.limit+"&q="+l.query,t(l.url),l.page=1,e.preventDefault()});d.addEventListener("click",function(t){e(1)}),u.addEventListener("click",function(t){e(0)})}),require(["utilities"],function(){require(["main"])});var wrapper_elt=document.querySelector(".progress-wrap"),progress_elt=document.querySelector(".progress-bar"),progress=0,width=wrapper_elt.getBoundingClientRect().width;